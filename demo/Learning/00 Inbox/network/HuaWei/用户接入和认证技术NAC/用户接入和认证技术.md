## 用户接入和认证技术
### AAA
#### 什么是AAA
authentication authorization accounting
认证        授权      审计
###### 最初的时候没有AAA
设备接入路由器,路由器做本地的认证/授权
这台路由器或者交换机设备会存储用户凭证信息(用户名,密码)
	管理:telnet/ssh
	其他:ppp/bpv
这种最初的设备问题就是配置量大,维护量也大,有变动所有的设备都得改

需求:因为上面的缺点,所以需要能够集中管理,多方接入因此产生了AAA
#### AAA服务器产生之后
本地也可以配置AAA但没有什么用并且本地AAA做不了accounting审计工作
前面一样中断链接交换机或者路由器,不同点这里额外链接一个aaa的服务器,sw或者routing认证信息集中在aaa(authentication authorization accounting)service中管理
多源接入:多个client链接aaa的服务器

#### AAA的整体架构
##### 认证方面 authentication
	用来确认用户是否合法
##### 授权方面authorization
	不同的合法用户赋予不同的权限
##### 审计方面 accounting 
	记录用户行和访问网络资源的情况(上下限时间,流量)

AAA构建的设备体系
1.  用户端 终端
2.  接入设备 AAA client (NAS,华为的me60就是NAS网络接入设备)
3.  AAA server

#### 服务器授权示意流程图
![[AAA的配置流程图.png]]

##  **重点在aaaserver只是进行3a的认证授权审计但是存储是在额外的存贮之中**

##### AAA服务器的协议:网络设备aaa的client 和aaa服务器的交互信令标准
###### Radius :基于udp,不能对操作命令进行控制        用于接入业务的管理
认证和授权:udp1812
审计:udp1813
###### Radius维护三个数据库
 1、用户数据库：收集记录用户信息（用户名密码）
 2、client ： 标识记录拿下设备接入（ip，mac）
 3、属性数据库： 对于陌生未知的设备信息通过属性进行存储 横重要提高了交互能力
	 AVP：attribute value pair   格式tlv格式
	 type：4
	 length ：长度
	 vlaue：x.x.x.x （抓包时候显示nas但是实际是接入服务器的ip地址）

**需要知道的常用属性类型 **
	 type 26 ： avp vender-soecial 厂商持有
	 type ： eap message（extensible authentication protocol 扩展认证协议）提供eap的协议支持
###### 用于认证的报文
access-request  认证请求
access-accept  认证接受
access-reject  认证拒绝
access-change（chap） 只有在chap的认证是后才会有 认真挑战报文，radius产生随机数

pap：二元认证
只发送authentication-request（id，user，password）
对方收到反馈authentication--ack、nak（id反馈信息）
无法区分不同的用户
chap：三元认证
首先由认证服务器发送challenge（id空，随机数，user空）发送，对方收到之后发送respone（id，hash（id，随机数密码）用户名）
认证服务器接受respone，根据id，随机数，密码
计算hash之后对比respone中的hash一样success否则failed

###### 审计的报文（了解）
accounting-request 开始计费响应
accounting-respone 开始计费回答
accounting-resquest 实时计费请求
account-response  实时计费应答
accounting-request 结束计费请求
accounting-respone 结束计费应答

###### Radius认证授权计费流程
![[radius认证授权审计流程.png]]

TACAS:基于tcp可以对操作命令进行操作   用于管理业务设备的方位管理
TACAS + 思科有的acs
HWCAS : 华为,私有的

**建议如果生产网的环境建议tacas,用户访问建议radius**

###### 授权authorization
radius 授权认证混合使用udp1812
一旦radius通过，回复access-accept中携带授权信息
用户对应vlan，acl，qos的一些标记

###### 审计accounting 本地不支持，不许通过aaa服务器实现
上下线时间，流量

### aaa配置流程
#### 注意认证可以混合配置
先配置认证模式
authentication scheme 《name》
authentication-mode radius local
这种模式下如果本地美创建但是radius存在会惊醒radius的认证
如果都创建了
radius认证失败才会本地认证
radius不响应才进行本地
上面是为了防止网络问题导致的无法链接一般telnet较多
authentication-mode local radius
本地没创建的情况进行radius认证
都创建情况如果本地认证失败radius不进行
*配置计费方案*
accounting-schme《name》
accounting-mode radius

配置aaa服务器末班
radius-server template《name》
radius-server share-key ciper Huawei@123 aaa client和aaa服务器的通讯密码
radius-server authentication ip port 配置aaa服务器人等的ip和地址
radius-server account ip port      配置aaa服务器审计的ip和端口

---
修改，创建，关联认证，授权，审计以及服务器模版
domain 《名字》   创建domain
authentication-scheme name
accounting-scheme 
radius-server template 

domain default  修改domain


### NAC (network admin control 网络准入 控制)
	属于安全的远程网络安全的接入部分，包含aaa可以这样简单理解

---
下面的可能不太重要
### 策略联动(较新的技术)

### 业务随行(较新的技术)
实际上面通过控制器来控制,像AAA和NAC都是通过命令行的模式来设置