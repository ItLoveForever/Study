# 区分服务框架流程
![[区分服务的简单流程描述.png]]
## 分类和标记
### 标记:marking
-  分类
	- 二层:
		-  802.1p :Ethernet,封装在802.1q里面
			- 占3bit,0~7
		- exp: mpls
			- 3bit 0~7 ,显示空:explicit 显示空 0, implicit 隐含空3(注意implicit弹出后标签就没了,但是explicit会保留)
		-  DE: 基本不用了帧中继使用(FR: frame-relay) :丢弃位 0/1
			- 帧中继入项大于出项证明超速,打上1表示被丢弃
	-  三层
		-  IPP (IP precedence) : ip优先级
			-  3 bit 0-7 个优先级
				-  7,6 协议保留,用于信号命令保留使用/控制基本
				-  5 一般是语音 voice
				-  4 有可能视屏,有可能数据
				-  3~1 数据
				-  0 默认
		-  DSCP(区分服务编码点)code point
			-  6bit
			- ![[Pasted image 20240407224152.png]]
			- DSCP可以说兼容了ip precedent 从cs 4 开始变化新增了丢弃的可能性41(100010),42(100100),43(100110)
			- 上面的设计用于阻塞避免,当队列满了之后对41,41丢完丢42,42丢完最后丢43当然41和43没有一定的先后顺序全靠我们定义的规则
			- 这些标记和拥塞避免和拥塞管理都相关
- 具体标记方法:参照traffic
## 测速 metering /着色
将不同的流浪按照速率进行分类,着色:红,绿,黄
**令牌桶只是对不同速率着色,不做任何操作**

##### 分类
单通:单通单速双色 GTS 流量整形
-  绿色:转发
- 红色:*缓存*
GTS :通用流量整形 :general traffic shapping
	对于太来讲:绿色转发,红色缓存到整形队列
-  单只流程:测速->着色->动作(绿色转发,红色缓存到wfq整形队列,队列满了,丢)
-  特点 : 需要有缓存,因此中低端设备只能做出项的整形
==**个人总结:说白了就是先定一个安全bandwidth的值,大于假设值1500,阈值1000那么发送1000出去500缓存等到不足1000的时候和这个数据结合成不超过1000的数据发送出去**==

双通单速三色 CAR 流量监管
	绿
	红
	黄
双桶双速三色 CAR
	红
	绿
	黄

术语解析
	BC : burst of committed : 承诺突发量(字节)bytes
		cbs committed burst siz
	T:周期
	CIR:committed information rata 承诺信息速率 bps
帮助理解:
	桶里面有令牌,所有令牌的大小加起来就是BC,并且在一个T注入BC的字节所以一个周期可以转发多少就是速率BC/T
	实际上设备中没有CIR这个东西,只有BC和T,这个CIR是给我们使用的

分类可以按照应用区分(acl,length)或者借助令牌桶进行不同颜色的着色
*cli 命令行窗口*
*gui 图形化界面,功能少,不方便,但是推广面很广*
管 :管理ssh
控 :控制层面通道bgp
转 :转发,封装
析:分析层面 